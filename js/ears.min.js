(function(c, d, f, h, p, U) {
  function E(a, b) {
    var e = typeof a[b];
    return"function" == e || !!("object" == e && a[b]) || "unknown" == e
  }
  function V() {
    if(!y(navigator.plugins) && "object" == typeof navigator.plugins["Shockwave Flash"]) {
      var a = navigator.plugins["Shockwave Flash"].description;
      a && (!y(navigator.mimeTypes) && navigator.mimeTypes["application/x-shockwave-flash"] && navigator.mimeTypes["application/x-shockwave-flash"].enabledPlugin) && (B = a.match(/\d+/g))
    }
    if(!B) {
      var b;
      try {
        b = new ActiveXObject("ShockwaveFlash.ShockwaveFlash"), B = Array.prototype.slice.call(b.GetVariable("$version").match(/(\d+),(\d+),(\d+),(\d+)/), 1)
      }catch(e) {
      }
    }
    if(!B) {
      return!1
    }
    a = parseInt(B[0], 10);
    b = parseInt(B[1], 10);
    R = 9 < a && 0 < b;
    return!0
  }
  function K() {
    if(!C) {
      C = !0;
      for(var a = 0;a < L.length;a++) {
        L[a]()
      }
      L.length = 0
    }
  }
  function D(a, b) {
    C ? a.call(b) : L.push(function() {
      a.call(b)
    })
  }
  function ba() {
    var a = parent;
    if("" !== H) {
      for(var b = 0, e = H.split(".");b < e.length;b++) {
        a = a[e[b]]
      }
    }
    return a.easyXDM
  }
  function r(a) {
    var b = a.toLowerCase().match(M);
    a = b[2];
    var e = b[3], b = b[4] || "";
    if("http:" == a && ":80" == b || "https:" == a && ":443" == b) {
      b = ""
    }
    return a + "//" + e + b
  }
  function I(a) {
    a = a.replace(ca, "$1/");
    if(!a.match(/^(http||https):\/\//)) {
      var b = "/" === a.substring(0, 1) ? "" : f.pathname;
      "/" !== b.substring(b.length - 1) && (b = b.substring(0, b.lastIndexOf("/") + 1));
      a = f.protocol + "//" + f.host + b + a
    }
    for(;W.test(a);) {
      a = a.replace(W, "")
    }
    return a
  }
  function F(a, b) {
    var e = "", k = a.indexOf("#");
    -1 !== k && (e = a.substring(k), a = a.substring(0, k));
    var k = [], c;
    for(c in b) {
      b.hasOwnProperty(c) && k.push(c + "\x3d" + U(b[c]))
    }
    return a + (X ? "#" : -1 == a.indexOf("?") ? "?" : "\x26") + k.join("\x26") + e
  }
  function y(a) {
    return"undefined" === typeof a
  }
  function s(a, b, e) {
    var k, c;
    for(c in b) {
      b.hasOwnProperty(c) && (c in a ? (k = b[c], "object" === typeof k ? s(a[c], k, e) : e || (a[c] = b[c])) : a[c] = b[c])
    }
    return a
  }
  function A(a) {
    if(y(N)) {
      var b = d.body.appendChild(d.createElement("form")), e = b.appendChild(d.createElement("input"));
      e.name = w + "TEST" + Y;
      N = e !== b.elements[e.name];
      d.body.removeChild(b)
    }
    N ? b = d.createElement('\x3ciframe name\x3d"' + a.props.name + '"/\x3e') : (b = d.createElement("IFRAME"), b.name = a.props.name);
    b.id = b.name = a.props.name;
    delete a.props.name;
    "string" == typeof a.container && (a.container = d.getElementById(a.container));
    a.container || (s(b.style, {position:"absolute", top:"-2000px", left:"0px"}), a.container = d.body);
    e = a.props.src;
    a.props.src = "javascript:false";
    s(b, a.props);
    b.border = b.frameBorder = 0;
    b.allowTransparency = !0;
    a.container.appendChild(b);
    a.onLoad && x(b, "load", a.onLoad);
    if(a.usePost) {
      var k = a.container.appendChild(d.createElement("form")), c;
      k.target = b.name;
      k.action = e;
      k.method = "POST";
      if("object" === typeof a.usePost) {
        for(var l in a.usePost) {
          a.usePost.hasOwnProperty(l) && (N ? c = d.createElement('\x3cinput name\x3d"' + l + '"/\x3e') : (c = d.createElement("INPUT"), c.name = l), c.value = a.usePost[l], k.appendChild(c))
        }
      }
      k.submit();
      k.parentNode.removeChild(k)
    }else {
      b.src = e
    }
    a.props.src = e;
    return b
  }
  function Z(a) {
    var b = a.protocol, e;
    a.isHost = a.isHost || y(u.xdm_p);
    X = a.hash || !1;
    a.props || (a.props = {});
    if(a.isHost) {
      a.remote = I(a.remote), a.channel = a.channel || "default" + Y++, a.secret = Math.random().toString(16).substring(2), y(b) && (b = r(f.href) == r(a.remote) ? "4" : E(c, "postMessage") || E(d, "postMessage") ? "1" : a.swf && E(c, "ActiveXObject") && V() ? "6" : "Gecko" === navigator.product && "frameElement" in c && -1 == navigator.userAgent.indexOf("WebKit") ? "5" : a.remoteHelper ? "2" : "0")
    }else {
      a.channel = u.xdm_c.replace(/["'<>\\]/g, "");
      a.secret = u.xdm_s;
      a.remote = u.xdm_e.replace(/["'<>\\]/g, "");
      var b = u.xdm_p, k;
      if(k = a.acl) {
        a: {
          k = a.acl;
          var v = a.remote;
          "string" == typeof k && (k = [k]);
          for(var l, n = k.length;n--;) {
            if(l = k[n], l = RegExp("^" == l.substr(0, 1) ? l : "^" + l.replace(/(\*)/g, ".$1").replace(/\?/g, ".") + "$"), l.test(v)) {
              k = !0;
              break a
            }
          }
          k = !1
        }
        k = !k
      }
      if(k) {
        throw Error("Access denied for " + a.remote);
      }
    }
    a.protocol = b;
    switch(b) {
      case "0":
        s(a, {interval:100, delay:2E3, useResize:!0, useParent:!1, usePolling:!1}, !0);
        if(a.isHost) {
          if(!a.local) {
            b = f.protocol + "//" + f.host;
            e = d.body.getElementsByTagName("img");
            for(v = e.length;v--;) {
              if(k = e[v], k.src.substring(0, b.length) === b) {
                a.local = k.src;
                break
              }
            }
            a.local || (a.local = c)
          }
          b = {xdm_c:a.channel, xdm_p:0};
          a.local === c ? (a.usePolling = !0, a.useParent = !0, a.local = f.protocol + "//" + f.host + f.pathname + f.search, b.xdm_e = a.local, b.xdm_pa = 1) : b.xdm_e = I(a.local);
          a.container && (a.useResize = !1, b.xdm_po = 1);
          a.remote = F(a.remote, b)
        }else {
          s(a, {channel:u.xdm_c, remote:u.xdm_e, useParent:!y(u.xdm_pa), usePolling:!y(u.xdm_po), useResize:a.useParent ? !1 : a.useResize})
        }
        e = [new g.stack.HashTransport(a), new g.stack.ReliableBehavior({}), new g.stack.QueueBehavior({encode:!0, maxLength:4E3 - a.remote.length}), new g.stack.VerifyBehavior({initiate:a.isHost})];
        break;
      case "1":
        e = [new g.stack.PostMessageTransport(a)];
        break;
      case "2":
        a.remoteHelper = I(a.remoteHelper);
        e = [new g.stack.NameTransport(a), new g.stack.QueueBehavior, new g.stack.VerifyBehavior({initiate:a.isHost})];
        break;
      case "3":
        e = [new g.stack.NixTransport(a)];
        break;
      case "4":
        e = [new g.stack.SameOriginTransport(a)];
        break;
      case "5":
        e = [new g.stack.FrameElementTransport(a)];
        break;
      case "6":
        B || V(), e = [new g.stack.FlashTransport(a)]
    }
    e.push(new g.stack.QueueBehavior({lazy:a.lazy, remove:!0}));
    return e
  }
  function $(a) {
    for(var b, e = {incoming:function(a, b) {
      this.up.incoming(a, b)
    }, outgoing:function(a, b) {
      this.down.outgoing(a, b)
    }, callback:function(a) {
      this.up.callback(a)
    }, init:function() {
      this.down.init()
    }, destroy:function() {
      this.down.destroy()
    }}, c = 0, d = a.length;c < d;c++) {
      b = a[c], s(b, e, !0), 0 !== c && (b.down = a[c - 1]), c !== d - 1 && (b.up = a[c + 1])
    }
    return b
  }
  function da(a) {
    a.up.down = a.down;
    a.down.up = a.up;
    a.up = a.down = null
  }
  var O = this, Y = Math.floor(1E4 * Math.random()), S = Function.prototype, M = /^((http.?:)\/\/([^:\/\s]+)(:\d+)*)/, W = /[\-\w]+\/\.\.\//, ca = /([^:])\/\//g, H = "", g = {}, ea = c.easyXDM, w = "easyXDM_", N, X = !1, B, R, x, G;
  if(E(c, "addEventListener")) {
    x = function(a, b, e) {
      a.addEventListener(b, e, !1)
    }, G = function(a, b, e) {
      a.removeEventListener(b, e, !1)
    }
  }else {
    if(E(c, "attachEvent")) {
      x = function(a, b, e) {
        a.attachEvent("on" + b, e)
      }, G = function(a, b, e) {
        a.detachEvent("on" + b, e)
      }
    }else {
      throw Error("Browser not supported");
    }
  }
  var C = !1, L = [], P;
  "readyState" in d ? (P = d.readyState, C = "complete" == P || ~navigator.userAgent.indexOf("AppleWebKit/") && ("loaded" == P || "interactive" == P)) : C = !!d.body;
  if(!C) {
    if(E(c, "addEventListener")) {
      x(d, "DOMContentLoaded", K)
    }else {
      if(x(d, "readystatechange", function() {
        "complete" == d.readyState && K()
      }), d.documentElement.doScroll && c === top) {
        var aa = function() {
          if(!C) {
            try {
              d.documentElement.doScroll("left")
            }catch(a) {
              h(aa, 1);
              return
            }
            K()
          }
        };
        aa()
      }
    }
    x(c, "load", K)
  }
  var u = function(a) {
    a = a.substring(1).split("\x26");
    for(var b = {}, e, c = a.length;c--;) {
      e = a[c].split("\x3d"), b[e[0]] = p(e[1])
    }
    return b
  }(/xdm_e=/.test(f.search) ? f.search : f.hash), T = function() {
    var a = {}, b = {a:[1, 2, 3]};
    if("undefined" != typeof JSON && "function" === typeof JSON.stringify && '{"a":[1,2,3]}' === JSON.stringify(b).replace(/\s/g, "")) {
      return JSON
    }
    Object.toJSON && '{"a":[1,2,3]}' === Object.toJSON(b).replace(/\s/g, "") && (a.stringify = Object.toJSON);
    "function" === typeof String.prototype.evalJSON && (b = '{"a":[1,2,3]}'.evalJSON(), b.a && (3 === b.a.length && 3 === b.a[2]) && (a.parse = function(a) {
      return a.evalJSON()
    }));
    return a.stringify && a.parse ? (T = function() {
      return a
    }, a) : null
  };
  s(g, {version:"2.4.17.1", query:u, stack:{}, apply:s, getJSONObject:T, whenReady:D, noConflict:function(a) {
    c.easyXDM = ea;
    (H = a) && (w = "easyXDM_" + H.replace(".", "_") + "_");
    return g
  }});
  g.DomHelper = {on:x, un:G, requiresJSON:function(a) {
    "object" == typeof c.JSON && c.JSON || d.write('\x3cscript type\x3d"text/javascript" src\x3d"' + a + '"\x3e\x3c/script\x3e')
  }};
  (function() {
    var a = {};
    g.Fn = {set:function(b, e) {
      a[b] = e
    }, get:function(b, e) {
      var c = a[b];
      e && delete a[b];
      return c
    }}
  })();
  g.Socket = function(a) {
    var b = $(Z(a).concat([{incoming:function(b, e) {
      a.onMessage(b, e)
    }, callback:function(b) {
      if(a.onReady) {
        a.onReady(b)
      }
    }}])), e = r(a.remote);
    this.origin = r(a.remote);
    this.destroy = function() {
      b.destroy()
    };
    this.postMessage = function(a) {
      b.outgoing(a, e)
    };
    b.init()
  };
  g.Rpc = function(a, b) {
    if(b.local) {
      for(var e in b.local) {
        if(b.local.hasOwnProperty(e)) {
          var c = b.local[e];
          "function" === typeof c && (b.local[e] = {method:c})
        }
      }
    }
    var d = $(Z(a).concat([new g.stack.RpcBehavior(this, b), {callback:function(b) {
      if(a.onReady) {
        a.onReady(b)
      }
    }}]));
    this.origin = r(a.remote);
    this.destroy = function() {
      d.destroy()
    };
    d.init()
  };
  g.stack.SameOriginTransport = function(a) {
    var b, e, c, d;
    return b = {outgoing:function(a, b, e) {
      c(a);
      e && e()
    }, destroy:function() {
      e && (e.parentNode.removeChild(e), e = null)
    }, onDOMReady:function() {
      d = r(a.remote);
      a.isHost ? (s(a.props, {src:F(a.remote, {xdm_e:f.protocol + "//" + f.host + f.pathname, xdm_c:a.channel, xdm_p:4}), name:w + a.channel + "_provider"}), e = A(a), g.Fn.set(a.channel, function(a) {
        c = a;
        h(function() {
          b.up.callback(!0)
        }, 0);
        return function(a) {
          b.up.incoming(a, d)
        }
      })) : (c = ba().Fn.get(a.channel, !0)(function(a) {
        b.up.incoming(a, d)
      }), h(function() {
        b.up.callback(!0)
      }, 0))
    }, init:function() {
      D(b.onDOMReady, b)
    }}
  };
  g.stack.FlashTransport = function(a) {
    function b(a, b) {
      h(function() {
        c.up.incoming(a, l)
      }, 0)
    }
    function e(b) {
      var c = a.swf + "?host\x3d" + a.isHost, e = "easyXDM_swf_" + Math.floor(1E4 * Math.random());
      g.Fn.set("flash_loaded" + b.replace(/[\-.]/g, "_"), function() {
        g.stack.FlashTransport[b].swf = n = m.firstChild;
        for(var a = g.stack.FlashTransport[b].queue, c = 0;c < a.length;c++) {
          a[c]()
        }
        a.length = 0
      });
      a.swfContainer ? m = "string" == typeof a.swfContainer ? d.getElementById(a.swfContainer) : a.swfContainer : (m = d.createElement("div"), s(m.style, R && a.swfNoThrottle ? {height:"20px", width:"20px", position:"fixed", right:0, top:0} : {height:"1px", width:"1px", position:"absolute", overflow:"hidden", right:0, top:0}), d.body.appendChild(m));
      var k = "callback\x3dflash_loaded" + b.replace(/[\-.]/g, "_") + "\x26proto\x3d" + O.location.protocol + "\x26domain\x3d" + O.location.href.match(M)[3] + "\x26port\x3d" + (O.location.href.match(M)[4] || "") + "\x26ns\x3d" + H;
      m.innerHTML = "\x3cobject height\x3d'20' width\x3d'20' type\x3d'application/x-shockwave-flash' id\x3d'" + e + "' data\x3d'" + c + "'\x3e\x3cparam name\x3d'allowScriptAccess' value\x3d'always'\x3e\x3c/param\x3e\x3cparam name\x3d'wmode' value\x3d'transparent'\x3e\x3cparam name\x3d'movie' value\x3d'" + c + "'\x3e\x3c/param\x3e\x3cparam name\x3d'flashvars' value\x3d'" + k + "'\x3e\x3c/param\x3e\x3cembed type\x3d'application/x-shockwave-flash' FlashVars\x3d'" + k + "' allowScriptAccess\x3d'always' wmode\x3d'transparent' src\x3d'" + 
      c + "' height\x3d'1' width\x3d'1'\x3e\x3c/embed\x3e\x3c/object\x3e"
    }
    var c, v, l, n, m;
    return c = {outgoing:function(b, c, e) {
      n.postMessage(a.channel, b.toString());
      e && e()
    }, destroy:function() {
      try {
        n.destroyChannel(a.channel)
      }catch(b) {
      }
      n = null;
      v && (v.parentNode.removeChild(v), v = null)
    }, onDOMReady:function() {
      l = a.remote;
      g.Fn.set("flash_" + a.channel + "_init", function() {
        h(function() {
          c.up.callback(!0)
        })
      });
      g.Fn.set("flash_" + a.channel + "_onMessage", b);
      a.swf = I(a.swf);
      var d = a.swf.match(M)[3], m = function() {
        g.stack.FlashTransport[d].init = !0;
        n = g.stack.FlashTransport[d].swf;
        n.createChannel(a.channel, a.secret, r(a.remote), a.isHost);
        a.isHost && (R && a.swfNoThrottle && s(a.props, {position:"fixed", right:0, top:0, height:"20px", width:"20px"}), s(a.props, {src:F(a.remote, {xdm_e:r(f.href), xdm_c:a.channel, xdm_p:6, xdm_s:a.secret}), name:w + a.channel + "_provider"}), v = A(a))
      };
      g.stack.FlashTransport[d] && g.stack.FlashTransport[d].init ? m() : g.stack.FlashTransport[d] ? g.stack.FlashTransport[d].queue.push(m) : (g.stack.FlashTransport[d] = {queue:[m]}, e(d))
    }, init:function() {
      D(c.onDOMReady, c)
    }}
  };
  g.stack.PostMessageTransport = function(a) {
    function b(b) {
      var c;
      if(b.origin) {
        c = r(b.origin)
      }else {
        if(b.uri) {
          c = r(b.uri)
        }else {
          if(b.domain) {
            c = f.protocol + "//" + b.domain
          }else {
            throw"Unable to retrieve the origin of the event";
          }
        }
      }
      c == l && b.data.substring(0, a.channel.length + 1) == a.channel + " " && e.up.incoming(b.data.substring(a.channel.length + 1), c)
    }
    var e, d, g, l;
    return e = {outgoing:function(b, c, e) {
      g.postMessage(a.channel + " " + b, c || l);
      e && e()
    }, destroy:function() {
      G(c, "message", b);
      d && (g = null, d.parentNode.removeChild(d), d = null)
    }, onDOMReady:function() {
      l = r(a.remote);
      if(a.isHost) {
        var n = function(l) {
          l.data == a.channel + "-ready" && (g = "postMessage" in d.contentWindow ? d.contentWindow : d.contentWindow.document, G(c, "message", n), x(c, "message", b), h(function() {
            e.up.callback(!0)
          }, 0))
        };
        x(c, "message", n);
        s(a.props, {src:F(a.remote, {xdm_e:r(f.href), xdm_c:a.channel, xdm_p:1}), name:w + a.channel + "_provider"});
        d = A(a)
      }else {
        x(c, "message", b), g = "postMessage" in c.parent ? c.parent : c.parent.document, g.postMessage(a.channel + "-ready", l), h(function() {
          e.up.callback(!0)
        }, 0)
      }
    }, init:function() {
      D(e.onDOMReady, e)
    }}
  };
  g.stack.FrameElementTransport = function(a) {
    var b, e, k, g;
    return b = {outgoing:function(a, b, c) {
      k.call(this, a);
      c && c()
    }, destroy:function() {
      e && (e.parentNode.removeChild(e), e = null)
    }, onDOMReady:function() {
      g = r(a.remote);
      a.isHost ? (s(a.props, {src:F(a.remote, {xdm_e:r(f.href), xdm_c:a.channel, xdm_p:5}), name:w + a.channel + "_provider"}), e = A(a), e.fn = function(a) {
        delete e.fn;
        k = a;
        h(function() {
          b.up.callback(!0)
        }, 0);
        return function(a) {
          b.up.incoming(a, g)
        }
      }) : (d.referrer && r(d.referrer) != u.xdm_e && (c.top.location = u.xdm_e), k = c.frameElement.fn(function(a) {
        b.up.incoming(a, g)
      }), b.up.callback(!0))
    }, init:function() {
      D(b.onDOMReady, b)
    }}
  };
  g.stack.NameTransport = function(a) {
    function b(b) {
      m.contentWindow.sendMessage(b, a.remoteHelper + (n ? "#_3" : "#_2") + a.channel)
    }
    function c() {
      n ? (2 === ++q || !n) && l.up.callback(!0) : (b("ready"), l.up.callback(!0))
    }
    function d(a) {
      l.up.incoming(a, J)
    }
    function f() {
      z && h(function() {
        z(!0)
      }, 0)
    }
    var l, n, m, t, q, z, J, Q;
    return l = {outgoing:function(a, c, e) {
      z = e;
      b(a)
    }, destroy:function() {
      m.parentNode.removeChild(m);
      m = null;
      n && (t.parentNode.removeChild(t), t = null)
    }, onDOMReady:function() {
      n = a.isHost;
      q = 0;
      J = r(a.remote);
      a.local = I(a.local);
      n ? (g.Fn.set(a.channel, function(b) {
        n && "ready" === b && (g.Fn.set(a.channel, d), c())
      }), Q = F(a.remote, {xdm_e:a.local, xdm_c:a.channel, xdm_p:2}), s(a.props, {src:Q + "#" + a.channel, name:w + a.channel + "_provider"}), t = A(a)) : (a.remoteHelper = a.remote, g.Fn.set(a.channel, d));
      var b = function() {
        var d = m || this;
        G(d, "load", b);
        g.Fn.set(a.channel + "_load", f);
        (function ga() {
          "function" == typeof d.contentWindow.sendMessage ? c() : h(ga, 50)
        })()
      };
      m = A({props:{src:a.local + "#_4" + a.channel}, onLoad:b})
    }, init:function() {
      D(l.onDOMReady, l)
    }}
  };
  g.stack.HashTransport = function(a) {
    function b() {
      if(t) {
        var a = t.location.href, b = "", c = a.indexOf("#");
        -1 != c && (b = a.substring(c));
        b && b != f && (f = b, e.up.incoming(f.substring(f.indexOf("_") + 1), J))
      }
    }
    var e, d, g, l, f, m, t, q, z, J;
    return e = {outgoing:function(b, c) {
      if(q) {
        var e = a.remote + "#" + m++ + "_" + b;
        (d || !z ? q.contentWindow : q).location = e
      }
    }, destroy:function() {
      c.clearInterval(g);
      (d || !z) && q.parentNode.removeChild(q);
      q = null
    }, onDOMReady:function() {
      d = a.isHost;
      l = a.interval;
      f = "#" + a.channel;
      m = 0;
      z = a.useParent;
      J = r(a.remote);
      if(d) {
        s(a.props, {src:a.remote, name:w + a.channel + "_provider"});
        if(z) {
          a.onLoad = function() {
            t = c;
            g = setInterval(b, l);
            e.up.callback(!0)
          }
        }else {
          var Q = 0, p = a.delay / 50;
          (function fa() {
            if(++Q > p) {
              throw Error("Unable to reference listenerwindow");
            }
            try {
              t = q.contentWindow.frames[w + a.channel + "_consumer"]
            }catch(c) {
            }
            t ? (g = setInterval(b, l), e.up.callback(!0)) : h(fa, 50)
          })()
        }
        q = A(a)
      }else {
        t = c, g = setInterval(b, l), z ? (q = parent, e.up.callback(!0)) : (s(a, {props:{src:a.remote + "#" + a.channel + new Date, name:w + a.channel + "_consumer"}, onLoad:function() {
          e.up.callback(!0)
        }}), q = A(a))
      }
    }, init:function() {
      D(e.onDOMReady, e)
    }}
  };
  g.stack.ReliableBehavior = function(a) {
    var b, c, d = 0, g = 0, l = "";
    return b = {incoming:function(a, f) {
      var h = a.indexOf("_"), q = a.substring(0, h).split(",");
      a = a.substring(h + 1);
      q[0] == d && (l = "", c && (c(!0), c = null));
      0 < a.length && (b.down.outgoing(q[1] + "," + d + "_" + l, f), g != q[1] && (g = q[1], b.up.incoming(a, f)))
    }, outgoing:function(a, f, h) {
      l = a;
      c = h;
      b.down.outgoing(g + "," + ++d + "_" + a, f)
    }}
  };
  g.stack.QueueBehavior = function(a) {
    function b() {
      if(a.remove && 0 === d.length) {
        da(c)
      }else {
        if(!g && !(0 === d.length || n)) {
          g = !0;
          var f = d.shift();
          c.down.outgoing(f.data, f.origin, function(a) {
            g = !1;
            f.callback && h(function() {
              f.callback(a)
            }, 0);
            b()
          })
        }
      }
    }
    var c, d = [], g = !0, f = "", n, m = 0, t = !1, q = !1;
    return c = {init:function() {
      y(a) && (a = {});
      a.maxLength && (m = a.maxLength, q = !0);
      a.lazy ? t = !0 : c.down.init()
    }, callback:function(a) {
      g = !1;
      var d = c.up;
      b();
      d.callback(a)
    }, incoming:function(b, d) {
      if(q) {
        var g = b.indexOf("_"), k = parseInt(b.substring(0, g), 10);
        f += b.substring(g + 1);
        0 === k && (a.encode && (f = p(f)), c.up.incoming(f, d), f = "")
      }else {
        c.up.incoming(b, d)
      }
    }, outgoing:function(g, f, l) {
      a.encode && (g = U(g));
      var h = [], n;
      if(q) {
        for(;0 !== g.length;) {
          n = g.substring(0, m), g = g.substring(n.length), h.push(n)
        }
        for(;n = h.shift();) {
          d.push({data:h.length + "_" + n, origin:f, callback:0 === h.length ? l : null})
        }
      }else {
        d.push({data:g, origin:f, callback:l})
      }
      t ? c.down.init() : b()
    }, destroy:function() {
      n = !0;
      c.down.destroy()
    }}
  };
  g.stack.VerifyBehavior = function(a) {
    function b() {
      d = Math.random().toString(16).substring(2);
      c.down.outgoing(d)
    }
    var c, d, g;
    return c = {incoming:function(f, h) {
      var m = f.indexOf("_");
      -1 === m ? f === d ? c.up.callback(!0) : g || (g = f, a.initiate || b(), c.down.outgoing(f)) : f.substring(0, m) === g && c.up.incoming(f.substring(m + 1), h)
    }, outgoing:function(a, b, g) {
      c.down.outgoing(d + "_" + a, b, g)
    }, callback:function(c) {
      a.initiate && b()
    }}
  };
  g.stack.RpcBehavior = function(a, b) {
    function c(a) {
      a.jsonrpc = "2.0";
      f.down.outgoing(h.stringify(a))
    }
    function d(a, b) {
      var g = Array.prototype.slice;
      return function() {
        var d = arguments.length, f, h = {method:b};
        0 < d && "function" === typeof arguments[d - 1] ? (1 < d && "function" === typeof arguments[d - 2] ? (f = {success:arguments[d - 2], error:arguments[d - 1]}, h.params = g.call(arguments, 0, d - 2)) : (f = {success:arguments[d - 1]}, h.params = g.call(arguments, 0, d - 1)), p["" + ++m] = f, h.id = m) : h.params = g.call(arguments, 0);
        a.namedParams && 1 === h.params.length && (h.params = h.params[0]);
        c(h)
      }
    }
    function g(a, b, d, f) {
      if(d) {
        var h, k;
        b ? (h = function(a) {
          h = S;
          c({id:b, result:a})
        }, k = function(a, d) {
          k = S;
          var f = {id:b, error:{code:-32099, message:a}};
          d && (f.error.data = d);
          c(f)
        }) : h = k = S;
        "[object Array]" !== Object.prototype.toString.call(f) && (f = [f]);
        try {
          var l = d.method.apply(d.scope, f.concat([h, k]));
          y(l) || h(l)
        }catch(m) {
          k(m.message)
        }
      }else {
        b && c({id:b, error:{code:-32601, message:"Procedure not found."}})
      }
    }
    var f, h = b.serializer || T(), m = 0, p = {};
    return f = {incoming:function(a, d) {
      var f = h.parse(a);
      if(f.method) {
        b.handle ? b.handle(f, c) : g(f.method, f.id, b.local[f.method], f.params)
      }else {
        var k = p[f.id];
        f.error ? k.error && k.error(f.error) : k.success && k.success(f.result);
        delete p[f.id]
      }
    }, init:function() {
      if(b.remote) {
        for(var c in b.remote) {
          b.remote.hasOwnProperty(c) && (a[c] = d(b.remote[c], c))
        }
      }
      f.down.init()
    }, destroy:function() {
      for(var c in b.remote) {
        b.remote.hasOwnProperty(c) && a.hasOwnProperty(c) && delete a[c]
      }
      f.down.destroy()
    }}
  };
  O.easyXDM = g
})(window, document, location, window.setTimeout, decodeURIComponent, encodeURIComponent);
var promise = function() {
};
promise.prototype = {pending:{resolve:function() {
}, reject:function() {
}}, then:function(c, d) {
  this.pending = {resolve:c, reject:d};
  return this
}, resolve:function(c) {
  this.pending.resolve(c)
}, reject:function(c) {
  this.pending.reject(c)
}};
try {
  addToNamespace("Promise", promise)
}catch(e$$13) {
  throw Error("Cannot extends 'Promise' to 'Adfab.playground.Promise'");
}
;var user = {env:{}, id:null, uid:null, data:{}, urls:{current:top.location.href, prev:null}, init:function() {
  PG.Util.GenerateUniqueId();
  PG.User.urls.prev = PG.Util.readCookie("prev-url");
  var c = PG.Util.readCookie("authent"), d = PG.Util.readCookie("last-sync"), f = (new Date).getTime();
  if(!PG.Util.not_null(d) || parseInt(d) + 86400 < f) {
    c = null
  }
  PG.Util.not_null(c) ? (PG.User.data = JSON.parse(PG.Util.readCookie("authent")), PG.User.checkUser()) : PG.User.loadAuthent().then(function() {
    PG.User.checkUser()
  })
}, isLogged:function() {
  var c;
  if("" === PG.User.id || null === PG.User.id) {
    PG.User.id = PG.Util.readCookie("login")
  }
  c = PG.Util.not_null(PG.User.id) ? !0 : !1;
  PG.Util.log("isLogged : " + c);
  return c
}, loadAuthent:function() {
  var c = new PG.Promise;
  PG.App.call(PG.Config.env[PG.Config.mode].connect).then(function(d) {
    PG.User.data = d;
    PG.Util.createCookie("last-sync", (new Date).getTime());
    PG.Util.createCookie("authent", JSON.stringify(d));
    c.resolve()
  });
  return c
}, checkUser:function() {
  PG.Util.not_null(PG.Util.readCookie("logout-try")) ? PG.Util.not_null(PG.User.data.library.stories.logout_user) && (PG.Util.not_null(PG.User.data.library.stories.logout_user.events.after) && PG.User.checkStory(PG.User.data.library.stories.logout_user.events.after)) && PG.User.logout() : PG.Util.not_null(PG.Util.readCookie("login-try")) && PG.Util.not_null(PG.User.data.library.stories.login_user) && (PG.Util.not_null(PG.User.data.library.stories.login_user.events.after) && PG.User.checkStory(PG.User.data.library.stories.login_user.events.after)) && 
  PG.User.login(PG.Util.readCookie("login-try"));
  PG.Util.not_null(PG.Util.readCookie("login")) ? PG.User.login(PG.Util.readCookie("login")) : PG.User.logout()
}, login:function(c) {
  PG.Util.eraseCookie("logout-try");
  PG.Util.log('Login "' + c + '"');
  PG.Util.not_null(c) && (PG.Util.eraseCookie("login-try"), PG.User.id = c, PG.Util.createCookie("login", c), PG.App.send(top.location.href));
  return PG.User.data.id
}, logout:function() {
  PG.Util.log("User is out");
  PG.Util.eraseCookie("logout-try");
  PG.Util.eraseCookie("login-try");
  PG.Util.eraseCookie("login");
  PG.User.id = null;
  PG.App.send(top.location.href)
}, checkEvidences:function(c) {
  var d = null, f = !0, h;
  for(h in c) {
    "id" === c[h].selector ? d = document.getElementById(c[h].name) : "class" === PG.User.data.evidences[h].selector && (d = document.getElementsByClassName(c[h].name)), null === d && (f = !1)
  }
  return f
}, checkStory:function(c) {
  var d = !1;
  PG.Util.not_null(c) && PG.Util.not_null(c) && (PG.Util.not_null(c.url) && PG.Util.not_null(c.xpath) && PG.Util.matchUrl(c.url) && PG.Util.checkXpath(c.xpath) ? d = !0 : PG.Util.not_null(c.url) && PG.Util.matchUrl(c.url) && !PG.Util.not_null(c.xpath) ? d = !0 : PG.Util.not_null(c.xpath) && (PG.Util.checkXpath(c.xpath) && !PG.Util.not_null(c.url)) && (d = !0));
  console.log(c);
  console.log("use : " + d);
  return d
}, getStory:function(c, d) {
  var f = {name:c, properties:[]}, h, p;
  if(PG.Util.not_null(d)) {
    for(p in d.properties) {
      h = d.properties[p], PG.Util.not_null(h) && "function" !== typeof h && PG.Util.not_null(PG.Util.getObjectFromXpath(h.xpath)[0]) && f.properties.push({name:h.name, value:PG.Util.getValueFromObject(PG.Util.getObjectFromXpath(h.xpath)[0])})
    }
  }
  return f
}, quit:function() {
  var c;
  PG.Util.createCookie("prev-url", top.location.href);
  PG.User.isLogged() ? PG.Util.not_null(PG.User.data.library.stories.logout_user) && PG.Util.not_null(PG.User.data.library.stories.logout_user.events.before) && PG.User.checkStory(PG.User.data.library.stories.logout_user.events.before) && (c = PG.User.getStory(PG.User.data.library.stories.logout_user.action, PG.User.data.library.stories.logout_user.objects), PG.Util.createCookie("logout-try", JSON.stringify(c))) : PG.Util.not_null(PG.User.data.library.stories.login_user) && PG.Util.not_null(PG.User.data.library.stories.login_user.events.before) && 
  PG.User.checkStory(PG.User.data.library.stories.login_user.events.before) && (c = PG.User.getStory(PG.User.data.library.stories.login_user.action, PG.User.data.library.stories.login_user.objects), PG.Util.createCookie("login-try", JSON.stringify(c)))
}};
try {
  addToNamespace("User", user)
}catch(e$$14) {
  throw Error("Cannot extends 'User' to 'Adfab.playground.User'");
}
;function App() {
  return this
}
App.prototype.init = function() {
  PG.Util.not_null(PG.Settings) && PG.Util.not_null(PG.Settings.apiKey) ? (PG.Util.log("APIKEY FOUND \x3d " + PG.Settings.apiKey), PG.App.easyXDM(), PG.App.bindEvent(), PG.User.init(), PG.Util.fireEvt("earsReady", window, {apiKey:PG.Settings.apiKey, uid:PG.User.uid, login:PG.User.id})) : PG.Util.log("NO APIKEY FOUND")
};
App.prototype.bindEvent = function() {
  var c, d, f;
  c = PG.Cache.xmlhttp.prototype.open;
  d = PG.Cache.xmlhttp.prototype.send;
  PG.Cache.xmlhttp.prototype.open = function(d, p) {
    d || (d = "");
    p || (p = "");
    c.apply(this, arguments);
    f = d;
    "get" == d.toLowerCase() && p.split("?")
  };
  PG.Cache.xmlhttp.prototype.send = function(c, p) {
    c || (c = "");
    p || (p = "");
    d.apply(this, arguments);
    f.toLowerCase()
  };
  PG.Cache.document.onreadystatechange = function(c) {
    PG.Util.not_null(c.data)
  };
  PG.Cache.window.onbeforeunload = function(c) {
    PG.User.quit();
    return null
  }
};
App.prototype.easyXDM = function() {
  PG.App.rpc = new easyXDM.Rpc({local:PG.Cache.protocol + PG.Config.env[PG.Config.mode].url + "easyXDM/name.html", swf:PG.Cache.protocol + PG.Config.env[PG.Config.mode].url + "easyXDM/easyxdm.swf", remote:PG.Cache.protocol + PG.Config.env[PG.Config.mode].url + "index.html"}, {remote:{request:{}}})
};
App.prototype.send = function(c) {
  var d = PG.User.data.library.config.broadcast, f = {user:{uid:PG.User.uid}, actions:[], page:{url:c}, apiKey:PG.Settings.apiKey}, h, p;
  if(!PG.Util.isUrlValid(c)) {
    return!1
  }
  for(h in PG.User.data.library.stories) {
    p = PG.User.data.library.stories[h], PG.User.checkStory(p.conditions) && (console.log("push : " + JSON.stringify(p.objects)), f.actions.push(PG.User.getStory(p.action, p.objects)))
  }
  if(d || 0 < f.actions.length) {
    PG.User.isLogged() && (f.user.login = PG.User.id), f.user = JSON.stringify(f.user), f.actions = JSON.stringify(f.actions), f.objects = JSON.stringify(f.objects), console.log("JSON"), console.log(p.user), console.log(p.actions), console.log(p.objects), c = PG.Cache.protocol + PG.Config.env[PG.Config.mode].url + PG.Config.env[PG.Config.mode].send, PG.App.rpc.request({url:c, method:"POST", data:f}, function(c) {
      PG.Util.log(c)
    }, function(c) {
      throw"Api Error, code : " + c.code + ", msg : " + c.message;
    })
  }
  return!0
};
App.prototype.call = function(c) {
  var d = new PG.Promise;
  PG.Util.log("call service : " + c);
  PG.App.rpc.request({url:PG.Cache.protocol + PG.Config.env[PG.Config.mode].url + c + "?apiKey\x3d" + PG.Settings.apiKey}, function(c) {
    d.resolve(JSON.parse(c.data))
  }, function(c) {
    throw"Api Error, code : " + c.code + ", msg : " + c.message;
  });
  return d
};
var app = new App;
try {
  addToNamespace("App", app)
}catch(e$$17) {
  throw Error("Cannot extends 'app' to 'Adfab.playground.App'");
}
app.init();
